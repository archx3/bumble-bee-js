var Bee=Bee||{};
(function(k,c){"function"===typeof define&&define.amd?define([],function(){return k[""]=c(k)}):"object"===typeof exports?module.exports=c(k):k.Tables=c(k)})(window,function(k){function c(a,b){h.assert(h.defined(k)&&h.defined(document),"Barge.Dom.Table requires a window object as host");if(!(this instanceof c))return new c(a,b);var d=this;this.options={sortable:!0,sortingRowStepping:1,stickyHead:!1,stickOnScroll:!0,paginate:!1,colResizable:!1,rowResizable:!0,scrollableContainer:null,hasCheckboxes:!1,
hasRevealer:!1,lastColIsCheckCol:!0,manageCheckboxGroup:{headCheckboxClass:"fatherCheckBx",checkBoxesClass:"checkBx",bdTable:d,editableRow:!1,inputSet:null},showOrHideCols:!0};b&&(this.options=h.extend(this.options,b));b.manageCheckboxGroup&&(this.options.manageCheckboxGroup=h.extend(this.options.manageCheckboxGroup,b.manageCheckboxGroup),h.defined(this.options.manageCheckboxGroup.bdTable)||(this.options.manageCheckboxGroup.bdTable=d));this.tableEl=h.isString(a)?Bee.Dom.getEl(a):a;h.assert(h.defined(this.tableEl),
"@param tableEl is missing; Bee.Dom.Table requires a table element to manage",function(){for(var a in d)delete d[a]});this.rows=this.tableEl.getElementsByTagName("TR");this.head=this.tableEl.getElementsByTagName("THEAD")[0];this.body=this.tableEl.getElementsByTagName("TBODY")[0];this.foot=this.tableEl.getElementsByTagName("TFOOT")[0];this.rowsCount=this.rows.length-1;this.colsCount=this.rows[0].children.length;this.pageRowsPerView=25;this.densityStyle=this.lastPageIndex=this.pages=this.sets=null;
this.stickyHead=this.options.stickyHead;this.init()}var h=Bee.utils,f=Bee.Array,l=Bee.String,p=Bee.Math,e=Bee.Dom;c.prototype.init=function(){var a=this;!0===this.options.sortable&&this.makeRowsSortable();this.applyDimensionsPrimer();!0===this.options.stickyHead&&this.makeHeadSticky();!0===this.options.paginate&&this.paginate();!0===this.options.colResizable&&this.makeColsResizable();!0===this.options.rowResizable&&this.makeRowsResizable();!0===this.options.stickOnScroll&&this.stickOnScroll();!0===
this.options.hasCheckboxes&&(new Bee.Input.Checkbox(this.options.manageCheckboxGroup)).manageCheckboxGroup(null,this.tableEl);if(this.options.showOrHideCols){var b=new Bee.Event.EventManager,d=Bee.Dom.getEl(".showOrHideCol",!0);b.bindOnAll(d,"click",function(b){this.checked?a.openCol(Bee.utils.pInt(this.value)):a.closeCol(Bee.utils.pInt(this.value))})}};c.prototype.insertRowAt=function(a,b){if(void 0===b?0:b)this.tableEl.appendChild(row);else{for(b=0;b<this.colsCount;b++)row.appendChild(e.createEl("td"));
f.insertAt(this.tbody,a)}};c.prototype.insertCol=function(a){this.getCol(a?a:this.colsCount);var b=this.getRows();f.forEach(b,function(b,g){a?0===g?e.insertChildAt(b,h.createEl("th"),a):e.insertChildAt(b,h.createEl("td"),a):0===g?b.appendChild(h.createEl("th")):b.appendChild(h.createEl("td"))})};c.prototype.insertCols=function(a,b){for(var d=0;d<a;d++)this.insertCol(b)};c.prototype.insertRow=function(a,b,d,g){g=void 0===g?!1:g;d=null;if(void 0===b?0:b)d=e.cloneNode(this.getRow("last"));else if(g)for(d=
e.createEl("tr"),b=0;b<this.colsCount;b++)d.appendChild(e.createEl("td"));a?e.insertChildAt(this.body,d,a):this.body.appendChild(d);return d};c.prototype.insertCellAt=function(a,b){e.insertChildAt(this.rows[a-1],e.createEl("td"),b+1)};c.prototype.insertRows=function(a,b){for(var d=0;d<a;d++)this.insertRow(b)};c.prototype.getRow=function(a){if(h.isString(a)){if("first"===a)return this.rows[0];if("last"===a)return this.rows[this.rows.length-1]}return this.rows[a-1]};c.prototype.rowIndex=function(a){return a.rowIndex-
1};c.prototype.getRows=function(a,b){var d=this;if(!a&&!b)return d.rows;var g=[];if(a&&!b)return f.forEach(d.rows,function(b,c){Bee.Math.isBetweenInclusive(c+1,{min:a,max:d.rows.length})&&g.push(b)}),g;if(a&&b)return f.forEach(d.rows,function(d,c){Bee.Math.isBetweenInclusive(c+1,{min:a,max:b})&&g.push(d)}),g};c.prototype.getCols=function(a,b){var d=[];if(!a&&!b)return this.rows;if(a&&!b){b=this.colsCount-a;for(var g=0;g<=b;g++)d.push(this.getCol(a+g));return d}if(a&&b){b-=a;for(g=0;g<=b;g++)d.push(this.getCol(a+
g));return d}};c.prototype._getCol=function(a,b){b=void 0===b?null:b;var d=[];f.forEach(b?b:this.rows,function(b){f.forEach(b.children,function(b,g){g+1===a&&d.push(b)})});return d};c.prototype.getCol=function(a){return this._getCol(a)};c.prototype.getCell=function(a,b){return this.getRow(a).children[b-1]};c.prototype.closeRow=function(a,b){(a=this.getRow(a))&&(b?e.closeWin(a,!0):e.closeWin(a,!1))};c.prototype.closeRows=function(a,b,d){if(a&&b){var g=this.getRows(a,b);f.forEach(g,function(a,b){g&&
(d?e.closeWin(a,!0):e.closeWin(a,!1))})}if(a&&!b){var c=this.getRows(a,this.rowsCount+1);f.forEach(c,function(a,b){c&&(d?e.closeWin(a,!0):e.closeWin(a,!1))})}else{var h=this.getRows();f.forEach(h,function(a,b){h&&(d?e.closeWin(a,!0):e.closeWin(a,!1))})}};c.prototype.openRow=function(a){(a=this.getRow(a))&&e.css(a,{display:""})};c.prototype.openRows=function(a,b){if(a&&b){var d=this.getRows(a,b);f.forEach(d,function(a,b){d&&e.css(a,{display:""})})}else{var g=this.getRows();f.forEach(g,function(a,b){g&&
e.css(a,{display:""})})}};c.prototype.closeCol=function(a,b){console.log("called");(a=this.getCol(a))&&(b?f.forEach(a,function(a,b){e.closeWin(a,!0)}):f.forEach(a,function(a){e.closeWin(a)}))};c.prototype.closeCols=function(a,b,d){var c=null;a||b?a&&!b?c=this.getCols(a,this.colsCount):a&&b&&(c=this.getCols(a,b)):c=this.getCols(1,this.colsCount);c&&f.forEach(c,function(a){f.forEach(a,function(a){d?e.closeWin(a,!0):e.closeWin(a)})})};c.prototype.openCols=function(a,b){var d=null;a||b?a&&!b?d=this.getCols(a,
this.colsCount):a&&b&&(d=this.getCols(a,b)):d=this.getCols(1,this.colsCount);d&&f.forEach(d,function(a){f.forEach(a,function(a){e.css(a,{display:""})})})};c.prototype.openCol=function(a){(a=this.getCol(a))&&f.forEach(a,function(a){e.css(a,{display:""})})};c.prototype.getSubTable=function(a,b){var d=[];2<arguments.length&&(h.extend(a,{startingRowId:arguments[0],endingRowId:arguments[1]}),h.extend(b,{startingColId:arguments[2],endingColId:arguments[2]}));var c=2<arguments.length?this.getRows(arguments[0],
arguments[1]):this.getRows(a.startingRowId,a.endingRowId);var e=2<arguments.length?arguments[3]-arguments[2]:b.endingColId-b.startingColId;for(var f=0;f<=e;f++)d.push(this._getCol(2<arguments.length?arguments[2]+f:b.startingColId+f,c));return d};c.prototype.setTextDensity=function(a){e.getEl("#densityStyle")||(this.densityStyle=e.createEl("style",{id:"densityStyle"}),e.appendToHead(this.densityStyle));if(h.isNumber(a))this.densityStyle.innerHTML="table td{ font-size : "+a+"px; padding: 8px 15px;}";
else if("small"===a||"s"===a||"1"===a)this.densityStyle.innerHTML="table td{ font-size : 13px; padding: 5px 15px;}";else if("medium"===a||"m"===a||"2"===a)this.densityStyle.innerHTML="table td{ font-size : 15px; padding: 8px 15px;}";else if("large"===a||"l"===a||"3"===a)this.densityStyle.innerHTML="table td{ font-size : 16px; padding: 10px 15px;}";!0===this.stickyHead&&this.makeHeadSticky();return this.densityStyle};c.prototype.makeRowsSortable=function(){(new Bee.Dom.TableSorter(this.tableEl,{rowStepping:this.options.sortingRowStepping})).init()};
c.prototype.applyDimensionsPrimer=function(){var a=this,b=this.getRow(1);b=b.children;var d=this.getRow(2).children,c=this.getRows(2),n=b.length-1,m=[];h.forEach(b,function(b,c){var g=!0===a.options.hasRevealer?n-1:n,f=d[c].offsetWidth-(0===c||c===g?1:2)-18;f=c===g?f+40:f;e.css(b,{width:f+"px"});m.push(f)});f.forEach(c,function(a){f.forEach(a.children,function(a,b){e.css(a,{width:b===n?m[b]+8+"px":0===b?m[b]-1+"px":m[b]+"px"})})});m=b=b=d=c=n=null};c.prototype.makeHeadSticky=function(a){var b=this.getRow(1);
e.css(b,{boxShadow:"0px 4px 3px rgba(0, 0, 0, .2)"});if(a){a=b.children;var d=this.getRow(2).children;h.forEach(a,function(a,b){e.css(a,{width:d[b].offsetWidth+10+"px"})});a=d=null}a=this.getCell(1,1);e.css(this.head,{position:"fixed"});e.css(a,{width:"39px !important"});e.css(this.body,{marginTop:this.head.offsetHeight+"px",display:"block"});h.defined(a.style.zIndex)?e.css(this.head,{zIndex:a.style.zIndex+1}):e.css(this.head,{zIndex:30});this.stickyHead=!0};c.prototype.unstickHead=function(a){var b=
this.getRow(1);e.css(b,{boxShadow:""});a&&(a=b.children,h.forEach(a,function(a){e.css(a,{width:""})}),a=null);e.css(this.head,{position:""});e.css(this.body,{marginTop:"0px",display:""});this.stickyHead=!1};c.prototype.stickOnScroll=function(){var a=this;this.options.scrollableContainer.onscroll=function(){18<this.scrollTop?a.makeHeadSticky():a.unstickHead()}};c.prototype.makeFirstColSticky=function(){var a=this.getCol(1),b=this.getCol(2),d=a[0].offsetWidth+"px";h.forEach(a,function(a,c){e.css(a,
{width:a.offsetWidth-1+"px"});e.css(a,{position:"fixed"});e.css(b[c],{marginLeft:d,display:"block"})})};c.prototype.makeRowsResizable=function(a){};c.prototype.ResizeCol=function(a,b){var d=this.getCol(a);a=this.getCell(1,a);var c=h.pInt(h.getStyleValue("width",a))+b;console.log(c);console.log(a);!0===this.stickyHead&&this.unstickHead();f.forEach(d,function(a,d){e.css(a,{width:c+b+"px"})})};c.prototype.makeColsResizable=function(){var a=this,b=this.getRow(1).children,c=b[0].offsetHeight;f.forEach(b,
function(b,d){d<a.colsCount-1&&(d=e.createEl("span",{className:"hResizeThumb"},{height:c+"px",width:"4px",left:e.getRight(b)+15+d+"px",top:b.parentElement.offsetTop+23+"px"}),b.appendChild(d))})};c.prototype.getRowText=function(a){a=h.isNumber(a)?this.getRow(a):a;var b="";f.forEach(a.children,function(a){b+=l.trim(a.textContent)+" "});return l.trim(b)};c.prototype.search=function(a){if(l.isEmpty(a))this.options.stickyHead&&(this.openRows(),this.makeHeadSticky());else{var b=this.getRows(2),c=this;
this.matchFound=!1;this.closeRows(2);f.forEach(b,function(b,d){-1!==c.getRowText(b).toLowerCase().indexOf(a.toLowerCase())&&(c.openRow(d+2),!1===c.matchFound&&(c.matchFound=!0))})}!0!==this.stickyHead||l.isEmpty(a)||this.unstickHead()};c.prototype.getFilterKeys=function(a){a=this.getCol(a);var b=[];f.forEach(a,function(a){0>b.indexOf(a.textContent)&&b.push(a.textContent)});a=null;return b};c.prototype.filter=function(a,b){if(l.isEmpty(b))this.options.stickyHead&&(this.openRows(),this.makeHeadSticky());
else{var c=this;this.closeRows(2);var e=this.getRows(2);f.forEach(e,function(d,e){d.children[a-1].textContent===b&&c.openRow(e+2)});e=null}!0!==this.stickyHead||l.isEmpty(b)||this.unstickHead()};c.prototype._setRowsPerView=function(a){a&&(this.pageRowsPerView=a)};c.prototype.setRowsPerView=function(a){a&&this.paginate(a)};c.prototype.paginate=function(a){this._setRowsPerView(a);this.sets=Math.ceil(this.rowsCount/this.pageRowsPerView);Bee.Math.modulo(this.rowsCount,this.pageRowsPerView);this.pages=
[];for(var b=0;b<this.sets;b++)this.pages.push(this.getRows(2+a*b,a*(b+1)));this.closeRows(this.pageRowsPerView+1);this.lastPageIndex=0};c.prototype.nextPage=function(){var a=this.lastPageIndex+(0===this.lastPageIndex?2:1);this.canNavigate(a)&&(this.showPage(a),this.lastPageIndex++)};c.prototype.previousPage=function(){var a=this.lastPageIndex-1;this.canNavigate(a)&&(this.showPage(a),this.lastPageIndex--)};c.prototype.goToPage=function(a){this.canNavigate(a)&&(this.showPage(a),this.lastPageIndex=
a)};c.prototype.canNavigate=function(a){return p.isBetweenInclusive(a,{min:0,max:this.pages.length})};c.prototype.showPage=function(a){this.closeRows(2);a=this.pages[a-1];f.forEach(a,function(a,c){e.css(a,{display:""})});a=null};return Bee.Dom.Table=c});
